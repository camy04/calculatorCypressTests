pipeline {

    agent any
    tools {nodejs "node15"}

    stages {
        
         stage("Run cypress tests") {

             steps { 
                echo 'Run cypress api and fromtend tests'
                sh "npm install cypress"
                catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
                    sh "npx cypress run"
                }
             }

         }

         stage("Publish test results ") {

             steps {
                echo 'Publishing Test results'
                publishHTML target : [
                    allowMissing: false,
                    alwaysLinkToLastBuild: true,
                    keepAll: true,
                    reportDir: 'cypress/report',
                    reportFiles: 'index.html',
                    reportName: 'Test Results',
                ]
             }
         }

    }
}